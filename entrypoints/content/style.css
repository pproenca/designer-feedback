@import "tailwindcss";

/* Enable class-based dark mode for Shadow DOM */
@variant dark (&:where(.dark, .dark *));

/* =============================================================================
   Theme and base styles
   ============================================================================= */

@theme {
  /* Colors */
  --color-df-blue: #3c82f7;
  --color-df-blue-soft: #d5e3ff;
  --color-df-yellow: #ffd60a;
  --color-df-red: #ff3b30;
  --color-df-green: #34c759;
  --color-df-purple: #af52de;
  --color-df-ink: #1a1a1a;
  --color-df-surface-muted: #f4f4f5;
  --color-df-surface-subtle: #f5f5f5;
  --color-df-dark: #1b1b1b;
  --color-df-dark-ink: #1a1a1a;
  --color-df-dark-strong: #151515;
  --color-df-dark-muted: #1c1c1c;
  --color-df-dark-subtle: #2a2a2a;
  --color-df-dark-hover: #242424;

  /* Font family */
  --font-family-sans: "Source Sans 3", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;

  /* Font sizes */
  --text-2xs: 0.625rem;
  --text-2xs--line-height: 1.4;
  --text-xs: 0.6875rem;
  --text-xs--line-height: 1.4;
  --text-sm: 0.8125rem;
  --text-sm--line-height: 1.5;

  /* Shadows */
  --shadow-toolbar: 0 6px 18px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.2);
  --shadow-toolbar-light: 0 2px 8px rgba(0, 0, 0, 0.08), 0 4px 16px rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0, 0, 0, 0.04);
  --shadow-tooltip: 0 6px 16px rgba(0, 0, 0, 0.3);
  --shadow-tooltip-light: 0 2px 8px rgba(0, 0, 0, 0.08), 0 4px 16px rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0, 0, 0, 0.04);
  --shadow-marker: 0 2px 6px rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(0, 0, 0, 0.04);
  --shadow-marker-soft: 0 3px 8px rgba(0, 0, 0, 0.35);
  --shadow-panel: 0 8px 22px rgba(0, 0, 0, 0.35), 0 0 0 1px rgba(255, 255, 255, 0.06);
  --shadow-panel-light: 0 4px 24px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.06);
  --shadow-popup: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.08);
  --shadow-popup-light: 0 4px 20px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.06);
  --shadow-modal: 0 20px 60px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(0, 0, 0, 0.06);
  --shadow-modal-dark: 0 18px 48px rgba(0, 0, 0, 0.45), 0 0 0 1px rgba(255, 255, 255, 0.08);
  --shadow-primary-glow: 0 4px 12px rgba(60, 130, 247, 0.25);

  /* Z-index scale */
  --z-overlay: 99997;
  --z-markers: 99998;
  --z-toolbar: 100000;
  --z-panel: 100001;
  --z-tooltip: 100002;
  --z-modal: 100010;

  /* Border radius */
  --radius-toolbar: 1.5rem;
  --radius-button: 50%;
  --radius-panel: 1rem;
  --radius-tooltip: 0.75rem;
  --radius-xl: 0.625rem;
  --radius-2xl: 1.125rem;
}

/* =============================================================================
   Base layer
   ============================================================================= */

@layer base {
  :host([data-capture='true']) {
    opacity: 0;
    pointer-events: none;
    transition: none;
  }

  :host {
    --df-font: "Source Sans 3", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }

  .df-root {
    --df-tooltip-delay: 850ms;
    transition: opacity 140ms cubic-bezier(0.32, 0.72, 0, 1);
  }

  .df-root[data-tooltips-ready='true'],
  .df-root [data-tooltips-ready='true'] {
    --df-tooltip-delay: 0ms;
  }

  .df-root[data-capture='true'] {
    opacity: 0;
    pointer-events: none;
    transition: none;
  }

  :host,
  :host * {
    font-family: var(--df-font);
    box-sizing: border-box;
  }
}

/* =============================================================================
   Reduced motion support
   ============================================================================= */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* =============================================================================
   Component styles - these will be replaced by Tailwind classes in components
   ============================================================================= */

@layer components {
  /* ==========================================================================
     Toolbar Components
     ========================================================================== */

  /* Toolbar button - base styles for all toolbar action buttons */
  .btn-toolbar {
    @apply relative flex items-center justify-center w-8.5 h-8.5 rounded-full;
    @apply border-none cursor-pointer;
    @apply transition duration-150;
    @apply focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-df-blue/50;
    @apply disabled:opacity-35 disabled:cursor-not-allowed;
    @apply active:enabled:scale-95;
    /* Light mode (default) */
    @apply bg-transparent text-black/50;
    @apply hover:enabled:bg-black/6 hover:enabled:text-black/85;
    /* Dark mode */
    @apply dark:text-white/85;
    @apply dark:hover:enabled:bg-white/12 dark:hover:enabled:text-white;
  }

  .btn-toolbar.active {
    @apply text-df-blue bg-df-blue/15;
    @apply dark:bg-df-blue/25;
  }

  .btn-toolbar.danger {
    @apply hover:enabled:bg-df-red/15 hover:enabled:text-df-red;
    @apply dark:hover:enabled:bg-df-red/25;
  }

  /* Tooltip - appears below toolbar buttons */
  .tooltip {
    @apply absolute top-full mt-3.5 left-1/2 -translate-x-1/2 scale-95;
    @apply px-2.5 py-1.5 text-xs font-medium rounded-lg whitespace-nowrap;
    @apply opacity-0 invisible pointer-events-none;
    z-index: var(--z-tooltip);
    @apply transition duration-150;
    transition-property: opacity, transform;
    /* Light mode (default) */
    @apply bg-white text-black/85 shadow-tooltip-light;
    /* Dark mode */
    @apply dark:bg-df-dark-ink dark:text-white/90 dark:shadow-tooltip;
    /* Arrow */
    @apply after:content-[''] after:absolute after:bottom-full after:translate-y-1 after:left-1/2 after:-translate-x-1/2 after:rotate-45;
    @apply after:w-2 after:h-2 after:rounded-tl-sm;
    @apply after:bg-white dark:after:bg-df-dark-ink;
  }

  .group:hover > .tooltip,
  .group:hover .tooltip {
    @apply opacity-100 visible scale-100;
    transition-delay: var(--df-tooltip-delay, 0ms);
  }

  /* Hide tooltip when button inside group is disabled */
  .group:has(button:disabled) > .tooltip,
  .group:has(button:disabled) .tooltip {
    @apply opacity-0 invisible;
  }

  /* Toolbar divider - vertical separator between button groups */
  .toolbar-divider {
    @apply w-px h-3 mx-0.5;
    /* Light mode (default) */
    @apply bg-black/10;
    /* Dark mode */
    @apply dark:bg-white/15;
  }

  /* Category panel - dropdown for selecting annotation type */
  .category-panel {
    @apply absolute top-full mt-3 left-1/2 -translate-x-1/2;
    @apply rounded-3xl p-3.5 flex flex-col gap-1 min-w-38;
    z-index: var(--z-panel);
    /* Light mode (default) */
    @apply bg-white shadow-panel-light;
    /* Dark mode */
    @apply dark:bg-df-dark dark:shadow-panel;
    /* Arrow */
    @apply after:content-[''] after:absolute after:-top-1.5 after:left-1/2 after:-translate-x-1/2 after:rotate-45;
    @apply after:w-3 after:h-3 after:rounded-tl-sm;
    @apply after:bg-white dark:after:bg-df-dark;
  }

  /* Category panel - opens upward when near viewport bottom */
  [data-panel-direction="up"] > .category-panel {
    top: auto;
    bottom: 100%;
    margin-top: 0;
    margin-bottom: 0.75rem;
  }

  [data-panel-direction="up"] > .category-panel::after {
    top: auto;
    bottom: -0.375rem;
    border-top-left-radius: 0;
    border-bottom-right-radius: 0.125rem;
  }

  /* Category panel - left-align when toolbar is on left side */
  [data-expand-direction="right"] > .category-panel {
    left: 0;
    translate: none;
  }

  [data-expand-direction="right"] > .category-panel::after {
    left: 1.25rem;
    translate: none;
  }

  /* Category panel item */
  .category-panel-item {
    @apply flex items-center gap-3 py-2.5 px-3;
    @apply border-none bg-transparent text-sm font-medium rounded-xl;
    @apply cursor-pointer whitespace-nowrap;
    @apply transition-colors duration-150;
    /* Light mode (default) */
    @apply text-black/70 hover:bg-black/6 hover:text-black/90;
    /* Dark mode */
    @apply dark:text-white/85 dark:hover:bg-white/10 dark:hover:text-white;
    /* Icon wrapper styling */
    @apply [&_svg]:transition-all [&_svg]:duration-150;
  }

  /* Icon wrapper with background circle */
  .category-panel-item svg {
    @apply p-1.5 rounded-lg;
    @apply bg-black/5 dark:bg-white/8;
    width: 32px;
    height: 32px;
  }

  /* On hover, apply category color to icon */
  .category-panel-item:hover svg {
    color: var(--category-color);
    background-color: color-mix(in srgb, var(--category-color) 12%, transparent);
  }

  .category-panel-item[data-category='bug'] {
    --category-color: var(--color-df-red);
  }

  .category-panel-item[data-category='question'] {
    --category-color: var(--color-df-yellow);
  }

  .category-panel-item[data-category='suggestion'] {
    --category-color: var(--color-df-blue);
  }

  .category-panel-item[data-category='accessibility'] {
    --category-color: var(--color-df-purple);
  }

  /* ==========================================================================
     Status Message Component
     ========================================================================== */

  /* Base status message styles */
  .status-message {
    @apply text-sm py-2 px-3 rounded-lg;
  }

  .status-message-success {
    @apply bg-green-100 text-green-800;
    @apply dark:bg-green-900/30 dark:text-green-300;
  }

  .status-message-error {
    @apply bg-red-100 text-red-800;
    @apply dark:bg-red-900/30 dark:text-red-300;
  }

  .status-message-warning {
    @apply bg-yellow-100 text-yellow-800;
    @apply dark:bg-yellow-900/30 dark:text-yellow-300;
  }

  .status-message-info {
    @apply bg-blue-100 text-blue-800;
    @apply dark:bg-blue-900/30 dark:text-blue-300;
  }

  /* ==========================================================================
     Scrollbar Styles
     ========================================================================== */

  .custom-scrollbar {
    @apply [&::-webkit-scrollbar]:w-1.5;
    @apply [&::-webkit-scrollbar-track]:bg-transparent;
    @apply [&::-webkit-scrollbar-thumb]:bg-black/15 [&::-webkit-scrollbar-thumb]:rounded-sm;
    @apply dark:[&::-webkit-scrollbar-thumb]:bg-white/20;
  }

}

/* =============================================================================
   Utility layer - Tailwind CSS v4 @utility directives
   ============================================================================= */

/* Z-Index Scale */
@utility z-overlay {
  z-index: var(--z-overlay);
}

@utility z-markers {
  z-index: var(--z-markers);
}

@utility z-toolbar {
  z-index: var(--z-toolbar);
}

@utility z-panel {
  z-index: var(--z-panel);
}

@utility z-tooltip {
  z-index: var(--z-tooltip);
}

@utility z-modal {
  z-index: var(--z-modal);
}

/* Focus Ring - consistent focus-visible outline */
@utility focus-ring {
  &:focus-visible {
    outline-width: 2px;
    outline-offset: 2px;
    outline-color: oklch(from var(--color-df-blue) l c h / 0.5);
  }
}

/* Text Colors - semantic text color variants */

/* Standard muted text (labels, secondary content) */
@utility text-muted {
  color: oklch(0 0 0 / 0.6);

  :where(.dark, .dark *) & {
    color: oklch(1 0 0 / 0.65);
  }
}

/* Softer muted text (placeholders, hints) */
@utility text-muted-soft {
  color: oklch(0 0 0 / 0.5);

  :where(.dark, .dark *) & {
    color: oklch(1 0 0 / 0.6);
  }
}

/* Stronger muted text (tertiary labels) */
@utility text-muted-strong {
  color: oklch(0 0 0 / 0.4);

  :where(.dark, .dark *) & {
    color: oklch(1 0 0 / 0.55);
  }
}

/* Transition Utilities - common interactive patterns */

/* Standard interactive transition (bg, color, transform) */
@utility transition-interactive {
  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
  transition-timing-function: cubic-bezier(0, 0, 0.2, 1);
  transition-duration: 150ms;
}
