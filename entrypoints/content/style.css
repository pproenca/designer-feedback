@import "tailwindcss";

/* Enable class-based dark mode for Shadow DOM */
@variant dark (&:where(.dark, .dark *));

/* =============================================================================
   Theme and base styles
   ============================================================================= */

@theme {
  /* Colors */
  --color-df-blue: #3c82f7;
  --color-df-red: #ff3b30;
  --color-df-green: #34c759;
  --color-df-dark: #1b1b1b;
  --color-df-dark-hover: #242424;

  /* Font family */
  --font-family-sans: "Source Sans 3", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;

  /* Shadows */
  --shadow-toolbar: 0 6px 18px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.2);
  --shadow-toolbar-light: 0 2px 8px rgba(0, 0, 0, 0.08), 0 4px 16px rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0, 0, 0, 0.04);
  --shadow-tooltip: 0 6px 16px rgba(0, 0, 0, 0.3);
  --shadow-tooltip-light: 0 2px 8px rgba(0, 0, 0, 0.08), 0 4px 16px rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0, 0, 0, 0.04);
  --shadow-marker: 0 2px 6px rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(0, 0, 0, 0.04);
  --shadow-panel: 0 8px 22px rgba(0, 0, 0, 0.35), 0 0 0 1px rgba(255, 255, 255, 0.06);
  --shadow-panel-light: 0 4px 24px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.06);
  --shadow-popup: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.08);
  --shadow-popup-light: 0 4px 20px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.06);

  /* Z-index scale */
  --z-overlay: 99997;
  --z-markers: 99998;
  --z-toolbar: 100000;
  --z-panel: 100001;
  --z-tooltip: 100002;
  --z-modal: 100010;

  /* Border radius */
  --radius-toolbar: 1.5rem;
  --radius-button: 50%;
  --radius-panel: 1rem;
  --radius-tooltip: 0.75rem;
}

/* =============================================================================
   Base layer
   ============================================================================= */

@layer base {
  :host {
    --df-font: "Source Sans 3", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }

  :host,
  :host * {
    font-family: var(--df-font);
    box-sizing: border-box;
  }
}

/* =============================================================================
   Reduced motion support
   ============================================================================= */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* =============================================================================
   Component styles - these will be replaced by Tailwind classes in components
   ============================================================================= */

@layer components {
  /* ==========================================================================
     Toolbar Components
     ========================================================================== */

  /* Toolbar button - base styles for all toolbar action buttons */
  .btn-toolbar {
    @apply relative flex items-center justify-center w-[34px] h-[34px] rounded-full;
    @apply border-none cursor-pointer;
    @apply transition-[background-color,color,transform,opacity] duration-150;
    @apply focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-df-blue/50;
    @apply disabled:opacity-35 disabled:cursor-not-allowed;
    @apply active:enabled:scale-92;
    /* Light mode (default) */
    @apply bg-transparent text-black/50;
    @apply hover:enabled:bg-black/6 hover:enabled:text-black/85;
    /* Dark mode */
    @apply dark:text-white/85;
    @apply dark:hover:enabled:bg-white/12 dark:hover:enabled:text-white;
  }

  .btn-toolbar.active {
    @apply text-df-blue bg-df-blue/15;
    @apply dark:bg-df-blue/25;
  }

  .btn-toolbar.danger {
    @apply hover:enabled:bg-df-red/15 hover:enabled:text-df-red;
    @apply dark:hover:enabled:bg-df-red/25;
  }

  /* Tooltip - appears below toolbar buttons */
  .tooltip {
    @apply absolute top-[calc(100%+14px)] left-1/2 -translate-x-1/2 scale-95;
    @apply px-2.5 py-1.5 text-xs font-medium rounded-lg whitespace-nowrap;
    @apply opacity-0 invisible pointer-events-none;
    z-index: var(--z-tooltip);
    @apply transition-[opacity,transform,visibility] duration-135;
    /* Light mode (default) */
    @apply bg-white text-black/85 shadow-tooltip-light;
    /* Dark mode */
    @apply dark:bg-[#1a1a1a] dark:text-white/90 dark:shadow-tooltip;
    /* Arrow */
    @apply after:content-[''] after:absolute after:bottom-[calc(100%-4px)] after:left-1/2 after:-translate-x-1/2 after:rotate-45;
    @apply after:w-2 after:h-2 after:rounded-tl-sm;
    @apply after:bg-white dark:after:bg-[#1a1a1a];
  }

  .group:hover > .tooltip,
  .group:hover .tooltip {
    @apply opacity-100 visible scale-100 delay-850;
  }

  /* Hide tooltip when button inside group is disabled */
  .group:has(button:disabled) > .tooltip,
  .group:has(button:disabled) .tooltip {
    @apply opacity-0 invisible;
  }

  /* Toolbar divider - vertical separator between button groups */
  .toolbar-divider {
    @apply w-px h-3 mx-0.5;
    /* Light mode (default) */
    @apply bg-black/10;
    /* Dark mode */
    @apply dark:bg-white/15;
  }

  /* ==========================================================================
     Action Button Components
     ========================================================================== */

  /* Action button base - for modal/popup action buttons */
  .btn-action {
    @apply py-2 px-4 rounded-lg text-sm font-medium cursor-pointer border-none;
    @apply transition-all duration-150 ease-out;
    @apply focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-df-blue/50;
    @apply disabled:opacity-50 disabled:cursor-not-allowed;
  }

  .btn-primary {
    @apply bg-df-blue text-white;
    @apply hover:enabled:-translate-y-px hover:enabled:shadow-[0_4px_12px_rgba(60,130,247,0.25)];
    @apply active:enabled:scale-[0.98];
  }

  .btn-secondary {
    @apply bg-transparent;
    /* Light mode (default) */
    @apply text-black/50 hover:bg-black/5 hover:text-black/85;
    /* Dark mode */
    @apply dark:text-white/45 dark:hover:bg-white/[0.06] dark:hover:text-white;
    @apply hover:-translate-y-px;
  }

  .btn-danger {
    @apply bg-red-500 text-white;
    @apply hover:bg-red-600;
    @apply focus-visible:outline-red-500/50;
  }

  /* ==========================================================================
     Category Selector Components
     ========================================================================== */

  .category-selector {
    @apply flex gap-1.5 mb-2;
  }

  .category-button {
    @apply flex-1 flex items-center justify-center gap-1 py-1.5 px-2;
    @apply bg-white/5 border border-white/10 rounded-lg;
    @apply text-white/60 text-[0.6875rem] font-medium cursor-pointer;
    @apply transition-colors duration-150 ease-out;
  }

  .category-button:focus-visible {
    @apply outline-2 outline-offset-2 outline-df-blue/50;
  }

  .category-button:hover {
    @apply bg-white/8 text-white/80;
  }

  .category-button.selected {
    background: color-mix(in srgb, var(--category-color) 20%, transparent);
    border-color: var(--category-color);
    color: var(--category-color);
  }

  /* ==========================================================================
     Utility Components
     ========================================================================== */

  /* Badge */
  .badge {
    @apply inline-flex items-center gap-1 py-0.5 px-2 rounded-full;
    @apply text-white font-medium whitespace-nowrap text-[0.625rem];
  }

  /* Category panel - dropdown for selecting annotation type */
  .category-panel {
    @apply absolute top-[calc(100%+12px)] left-1/2 -translate-x-1/2;
    @apply rounded-2xl p-3 flex flex-col gap-1 min-w-[140px];
    z-index: var(--z-panel);
    /* Light mode (default) */
    @apply bg-white shadow-panel-light;
    /* Dark mode */
    @apply dark:bg-df-dark dark:shadow-panel;
    /* Arrow */
    @apply after:content-[''] after:absolute after:-top-1.5 after:left-1/2 after:-translate-x-1/2 after:rotate-45;
    @apply after:w-3 after:h-3 after:rounded-tl-sm;
    @apply after:bg-white dark:after:bg-df-dark;
  }

  /* Category panel item */
  .category-panel-item {
    @apply flex items-center gap-2.5 py-2.5 px-3.5;
    @apply border-none bg-transparent text-[13px] font-medium rounded-xl;
    @apply cursor-pointer whitespace-nowrap;
    @apply transition-[background-color,color] duration-150;
    /* Light mode (default) */
    @apply text-black/70 hover:bg-black/6 hover:text-black/90;
    /* Dark mode */
    @apply dark:text-white/85 dark:hover:bg-white/10 dark:hover:text-white;
    /* Icon color on hover */
    @apply [&:hover_svg]:text-[var(--category-color)];
    @apply [&_svg]:transition-colors [&_svg]:duration-150;
  }

  /* ==========================================================================
     Panel Components (Popups, Modals)
     ========================================================================== */

  /* Popup base - annotation popup container */
  .popup-panel {
    @apply fixed w-[300px] -translate-x-1/2;
    z-index: var(--z-panel);
    @apply px-4 pt-3 pb-3.5 rounded-2xl;
    @apply font-sans cursor-default;
    /* Light mode (default) */
    @apply bg-white shadow-panel-light;
    /* Dark mode */
    @apply dark:bg-df-dark dark:shadow-panel;
  }

  /* Modal overlay */
  .modal-overlay {
    @apply fixed inset-0 flex items-center justify-center;
    z-index: var(--z-modal);
    /* Light mode (default) */
    @apply bg-[rgba(250,250,250,0.88)];
    /* Dark mode */
    @apply dark:bg-[rgba(10,10,10,0.82)];
  }

  /* Modal container */
  .modal-panel {
    @apply relative z-[1] rounded-[18px] w-[90%] max-w-[400px] max-h-[80vh];
    @apply overflow-hidden flex flex-col font-sans;
    /* Light mode (default) */
    @apply bg-white shadow-[0_20px_60px_rgba(0,0,0,0.2),0_0_0_1px_rgba(0,0,0,0.06)];
    /* Dark mode */
    @apply dark:bg-[#151515] dark:shadow-[0_18px_48px_rgba(0,0,0,0.45),0_0_0_1px_rgba(255,255,255,0.08)];
  }

  /* ==========================================================================
     Status Message Components
     ========================================================================== */

  .status-message {
    @apply mt-[0.6rem] py-[0.6rem] px-3 rounded-[10px] text-xs leading-[1.4] border;
  }

  .status-message.success {
    /* Light mode (default) */
    @apply text-green-800 bg-green-600/[0.12] border-green-600/30;
    /* Dark mode */
    @apply dark:text-[#bff1c9] dark:bg-green-500/[0.16] dark:border-green-500/[0.35];
  }

  .status-message.warning {
    /* Light mode (default) */
    @apply text-amber-800 bg-amber-500/[0.14] border-amber-500/30;
    /* Dark mode */
    @apply dark:text-[#fde68a] dark:bg-amber-500/[0.18] dark:border-amber-500/[0.35];
  }

  .status-message.error {
    /* Light mode (default) */
    @apply text-red-800 bg-red-600/[0.12] border-red-600/30;
    /* Dark mode */
    @apply dark:text-[#fecaca] dark:bg-red-500/[0.18] dark:border-red-500/40;
  }

  .status-message.info {
    /* Light mode (default) */
    @apply text-black/65 bg-blue-600/10 border-blue-600/25;
    /* Dark mode */
    @apply dark:text-white/75 dark:bg-blue-500/[0.12] dark:border-blue-500/30;
  }
}

/* =============================================================================
   Utility layer
   ============================================================================= */

@layer utilities {
  .z-overlay {
    z-index: var(--z-overlay);
  }

  .z-markers {
    z-index: var(--z-markers);
  }

  .z-toolbar {
    z-index: var(--z-toolbar);
  }

  .z-panel {
    z-index: var(--z-panel);
  }

  .z-tooltip {
    z-index: var(--z-tooltip);
  }

  .z-modal {
    z-index: var(--z-modal);
  }
}
